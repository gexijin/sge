<div class="figure">
<img src="/post/2018-07-02-deseq2-experimental-design-and-interpretation_files/factors5.jpg" />

</div>
<p><em>Update. 11/13/17 Thanks to Mike Love for pointing out an error. This is just my understanding. There maybe other errors.</em></p>
<p>To allow complex study designs in iDEP(http://ge-lab.org/idep/), I tried to understand how factoral models are built and the desired results are extracted from DESeq2. The following is based on the help document from the resutls( ) function in DESeq2, plus some of Mike Love's answers to questions from users.</p>
<p>An important point I want to make is the interpretation of results is tricky when the study design involve multiple factors. See figure above for an example involving 3 genotypes under 3 conditions. Similar to regression analysis in R, the <em>reference levels</em> for categorical factors forms the foundation of our intereptation. Yet, by default, they are determined alphabetically.</p>
<p>Before runing DESeq2, it is essential to choose appropriate reference levels for each factors. This can be done by the relevel( ) function in R. Reference level is the baseline level of a factor that forms the basis of meaningful comparisons. In a wildtype vs. mutant experiment, &quot;wild-type&quot; is the reference level. In treated vs. untreated, the reference level is obviously untreated. More details in Exmple 3.</p>
<p>iDEP provides a GUI to DESeq2 for most experimental desings. It also provides convienent interface for exploratory data anlysis and pathway analysis. Try it at http://ge-lab.org/idep/</p>
<div id="example-1-two-group-comparison" class="section level1">
<h1><span class="header-section-number">1</span> Example 1: two-group comparison</h1>
<p>First make some example data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(DESeq2)
dds &lt;-<span class="st"> </span><span class="kw">makeExampleDESeqDataSet</span>(<span class="dt">n=</span><span class="dv">10000</span>,<span class="dt">m=</span><span class="dv">6</span>)
<span class="kw">assay</span>(dds)[ <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,]</code></pre></div>
<pre><code>##        sample1 sample2 sample3 sample4 sample5 sample6
## gene1        6       4      11       1       2      13
## gene2        9      12      23      13      14      28
## gene3       58     121     173     178     118      97
## gene4        0       4       0       3       8       3
## gene5       27       3       6       9       8      12
## gene6       48       8      35      38      21      13
## gene7       36      50      61      52      44      22
## gene8        6       8      16      14      18      19
## gene9      214     266     419     198     157     166
## gene10      20      12      16      12      16       2</code></pre>
<p>This is a very simple experiment design with two conditions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colData</span>(dds)</code></pre></div>
<pre><code>## DataFrame with 6 rows and 1 column
##         condition
##          &lt;factor&gt;
## sample1         A
## sample2         A
## sample3         A
## sample4         B
## sample5         B
## sample6         B</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dds &lt;-<span class="st"> </span><span class="kw">DESeq</span>(dds)
<span class="kw">resultsNames</span>(dds)</code></pre></div>
<pre><code>## [1] &quot;Intercept&quot;        &quot;condition_B_vs_A&quot;</code></pre>
<p>This shows the results available. Note that by default, R will choose a reference level for factors based on alphabetical order. Here A is the referece level. Fold change is defined as B compaired with A. To change reference levels, try the relevel( ) function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast=</span><span class="kw">c</span>(<span class="st">&quot;condition&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;A&quot;</span>))
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),]
<span class="kw">library</span>(knitr)
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene9056</td>
<td align="right">360.168909</td>
<td align="right">-2.045379</td>
<td align="right">0.0000000</td>
<td align="right">0.0001372</td>
</tr>
<tr class="even">
<td align="left">gene3087</td>
<td align="right">43.897516</td>
<td align="right">-2.203303</td>
<td align="right">0.0000173</td>
<td align="right">0.0857004</td>
</tr>
<tr class="odd">
<td align="left">gene3763</td>
<td align="right">72.409877</td>
<td align="right">-1.834787</td>
<td align="right">0.0000433</td>
<td align="right">0.1434364</td>
</tr>
<tr class="even">
<td align="left">gene2054</td>
<td align="right">322.494963</td>
<td align="right">1.537408</td>
<td align="right">0.0000682</td>
<td align="right">0.1692730</td>
</tr>
<tr class="odd">
<td align="left">gene4617</td>
<td align="right">6.227415</td>
<td align="right">6.125238</td>
<td align="right">0.0002015</td>
<td align="right">0.4001027</td>
</tr>
</tbody>
</table>
<p>If we want to use B as control and define fold change using B as baseline. Then we can do this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast=</span><span class="kw">c</span>(<span class="st">&quot;condition&quot;</span>,<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>))
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj)
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),]
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene9056</td>
<td align="right">360.168909</td>
<td align="right">2.045379</td>
<td align="right">0.0000000</td>
<td align="right">0.0001372</td>
</tr>
<tr class="even">
<td align="left">gene3087</td>
<td align="right">43.897516</td>
<td align="right">2.203303</td>
<td align="right">0.0000173</td>
<td align="right">0.0857004</td>
</tr>
<tr class="odd">
<td align="left">gene3763</td>
<td align="right">72.409877</td>
<td align="right">1.834787</td>
<td align="right">0.0000433</td>
<td align="right">0.1434364</td>
</tr>
<tr class="even">
<td align="left">gene2054</td>
<td align="right">322.494963</td>
<td align="right">-1.537408</td>
<td align="right">0.0000682</td>
<td align="right">0.1692730</td>
</tr>
<tr class="odd">
<td align="left">gene4617</td>
<td align="right">6.227415</td>
<td align="right">-6.125238</td>
<td align="right">0.0002015</td>
<td align="right">0.4001027</td>
</tr>
</tbody>
</table>
<p>As you can see, the fold-change are completely opposite direction. Here we show the most significant gene.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-6-1.png" width="576" /></p>
</div>
<div id="example-2-multiple-groups" class="section level1">
<h1><span class="header-section-number">2</span> Example 2: Multiple groups</h1>
<p>Suppose we have three groups A, B, and C.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dds &lt;-<span class="st"> </span><span class="kw">makeExampleDESeqDataSet</span>(<span class="dt">n=</span><span class="dv">100</span>,<span class="dt">m=</span><span class="dv">6</span>)
dds<span class="op">$</span>condition &lt;-<span class="st"> </span><span class="kw">factor</span>( <span class="kw">c</span>( <span class="st">&quot;A&quot;</span>,<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;C&quot;</span>) )
dds &lt;-<span class="st"> </span><span class="kw">DESeq</span>(dds)
res =<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast=</span><span class="kw">c</span>(<span class="st">&quot;condition&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;A&quot;</span>))
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),]
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene2</td>
<td align="right">3.634986</td>
<td align="right">-5.101773</td>
<td align="right">0.0348679</td>
<td align="right">0.5515088</td>
</tr>
<tr class="even">
<td align="left">gene20</td>
<td align="right">4.678176</td>
<td align="right">-4.490982</td>
<td align="right">0.0445664</td>
<td align="right">0.5515088</td>
</tr>
<tr class="odd">
<td align="left">gene34</td>
<td align="right">56.068672</td>
<td align="right">-1.462155</td>
<td align="right">0.0167820</td>
<td align="right">0.5515088</td>
</tr>
<tr class="even">
<td align="left">gene35</td>
<td align="right">537.847175</td>
<td align="right">-1.177240</td>
<td align="right">0.0087913</td>
<td align="right">0.5515088</td>
</tr>
<tr class="odd">
<td align="left">gene41</td>
<td align="right">93.967810</td>
<td align="right">1.064734</td>
<td align="right">0.0412034</td>
<td align="right">0.5515088</td>
</tr>
</tbody>
</table>
</div>
<div id="example-3-two-conditions-two-genotypes-with-an-interaction-term" class="section level1">
<h1><span class="header-section-number">3</span> Example 3: two conditions, two genotypes, with an interaction term</h1>
<p>Here we have two genotypes, wild-type (WT), and mutant (MU). Two conditions, control (Ctrl) and treated (Trt). We are interested in the responses of both wild-type and mutant to treatment. We are also interested in the differences in response between genotypes, which is captured by the interaction term in linear models.</p>
<p>First, we construct example data. Note that we changed sample names from &quot;sample1&quot; to &quot;Wt_Ctrl_1&quot;, according to the two factors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dds &lt;-<span class="st"> </span><span class="kw">makeExampleDESeqDataSet</span>(<span class="dt">n=</span><span class="dv">10000</span>,<span class="dt">m=</span><span class="dv">12</span>)
dds<span class="op">$</span>condition &lt;-<span class="st"> </span><span class="kw">factor</span>( <span class="kw">c</span>( <span class="kw">rep</span>(<span class="st">&quot;Ctrl&quot;</span>,<span class="dv">6</span>), <span class="kw">rep</span>(<span class="st">&quot;Trt&quot;</span>,<span class="dv">6</span>) ) )
dds<span class="op">$</span>genotype &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;WT&quot;</span>,<span class="st">&quot;MU&quot;</span>),<span class="dt">each=</span><span class="dv">3</span>),<span class="dv">2</span>))
<span class="kw">colnames</span>(dds) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">as.character</span>( dds<span class="op">$</span>genotype),<span class="kw">as.character</span>( dds<span class="op">$</span>condition),<span class="kw">rownames</span>(<span class="kw">colData</span>(dds)),  <span class="dt">sep=</span><span class="st">&quot;_&quot;</span>  )
<span class="kw">colnames</span>(dds) =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;sample&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="kw">colnames</span>(dds))
<span class="kw">kable</span>(<span class="kw">assay</span>(dds)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,])</code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="5%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">WT_Ctrl_1</th>
<th align="right">WT_Ctrl_2</th>
<th align="right">WT_Ctrl_3</th>
<th align="right">MU_Ctrl_4</th>
<th align="right">MU_Ctrl_5</th>
<th align="right">MU_Ctrl_6</th>
<th align="right">WT_Trt_7</th>
<th align="right">WT_Trt_8</th>
<th align="right">WT_Trt_9</th>
<th align="right">MU_Trt_10</th>
<th align="right">MU_Trt_11</th>
<th align="right">MU_Trt_12</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene1</td>
<td align="right">81</td>
<td align="right">47</td>
<td align="right">135</td>
<td align="right">72</td>
<td align="right">81</td>
<td align="right">80</td>
<td align="right">76</td>
<td align="right">57</td>
<td align="right">52</td>
<td align="right">49</td>
<td align="right">64</td>
<td align="right">57</td>
</tr>
<tr class="even">
<td align="left">gene2</td>
<td align="right">70</td>
<td align="right">77</td>
<td align="right">94</td>
<td align="right">54</td>
<td align="right">54</td>
<td align="right">36</td>
<td align="right">51</td>
<td align="right">66</td>
<td align="right">57</td>
<td align="right">51</td>
<td align="right">47</td>
<td align="right">67</td>
</tr>
<tr class="odd">
<td align="left">gene3</td>
<td align="right">16</td>
<td align="right">37</td>
<td align="right">8</td>
<td align="right">28</td>
<td align="right">4</td>
<td align="right">36</td>
<td align="right">14</td>
<td align="right">10</td>
<td align="right">7</td>
<td align="right">11</td>
<td align="right">40</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">gene4</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">9</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">14</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">gene5</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>( <span class="kw">colData</span>(dds))</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">condition</th>
<th align="left">genotype</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">WT_Ctrl_1</td>
<td align="left">Ctrl</td>
<td align="left">WT</td>
</tr>
<tr class="even">
<td align="left">WT_Ctrl_2</td>
<td align="left">Ctrl</td>
<td align="left">WT</td>
</tr>
<tr class="odd">
<td align="left">WT_Ctrl_3</td>
<td align="left">Ctrl</td>
<td align="left">WT</td>
</tr>
<tr class="even">
<td align="left">MU_Ctrl_4</td>
<td align="left">Ctrl</td>
<td align="left">MU</td>
</tr>
<tr class="odd">
<td align="left">MU_Ctrl_5</td>
<td align="left">Ctrl</td>
<td align="left">MU</td>
</tr>
<tr class="even">
<td align="left">MU_Ctrl_6</td>
<td align="left">Ctrl</td>
<td align="left">MU</td>
</tr>
<tr class="odd">
<td align="left">WT_Trt_7</td>
<td align="left">Trt</td>
<td align="left">WT</td>
</tr>
<tr class="even">
<td align="left">WT_Trt_8</td>
<td align="left">Trt</td>
<td align="left">WT</td>
</tr>
<tr class="odd">
<td align="left">WT_Trt_9</td>
<td align="left">Trt</td>
<td align="left">WT</td>
</tr>
<tr class="even">
<td align="left">MU_Trt_10</td>
<td align="left">Trt</td>
<td align="left">MU</td>
</tr>
<tr class="odd">
<td align="left">MU_Trt_11</td>
<td align="left">Trt</td>
<td align="left">MU</td>
</tr>
<tr class="even">
<td align="left">MU_Trt_12</td>
<td align="left">Trt</td>
<td align="left">MU</td>
</tr>
</tbody>
</table>
<p>Check reference levels:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dds<span class="op">$</span>condition</code></pre></div>
<pre><code>##  [1] Ctrl Ctrl Ctrl Ctrl Ctrl Ctrl Trt  Trt  Trt  Trt  Trt  Trt 
## Levels: Ctrl Trt</code></pre>
<p>As you could see, &quot;Ctrl&quot; apeared first in the 2nd line, indicating it is the reference level for factor condition, as we can expect based on alphabetical order. This is what we want and we do not need to do anything.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dds<span class="op">$</span>genotype</code></pre></div>
<pre><code>##  [1] WT WT WT MU MU MU WT WT WT MU MU MU
## Levels: MU WT</code></pre>
<p>But &quot;Mu&quot; is the reference level for genotype, which is will give us results difficult to interpret. We need to change it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dds<span class="op">$</span>genotype =<span class="st"> </span><span class="kw">relevel</span>( dds<span class="op">$</span>genotype, <span class="st">&quot;WT&quot;</span>)
dds<span class="op">$</span>genotype</code></pre></div>
<pre><code>##  [1] WT WT WT MU MU MU WT WT WT MU MU MU
## Levels: WT MU</code></pre>
<p>Set up the model, and run DESeq2:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">design</span>(dds) &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>genotype <span class="op">+</span><span class="st"> </span>condition <span class="op">+</span><span class="st"> </span>genotype<span class="op">:</span>condition
dds &lt;-<span class="st"> </span><span class="kw">DESeq</span>(dds) 
<span class="kw">resultsNames</span>(dds)</code></pre></div>
<pre><code>## [1] &quot;Intercept&quot;               &quot;genotype_MU_vs_WT&quot;      
## [3] &quot;condition_Trt_vs_Ctrl&quot;   &quot;genotypeMU.conditionTrt&quot;</code></pre>
<p>Below, we are going to use the combination of the different results (&quot;genotype_MU_vs_WT&quot;, &quot;condition_Trt_vs_Ctrl&quot;, &quot;genotypeMU.conditionTrt&quot; ) to derive biologically meaningful comparisons.</p>
<div id="the-effect-of-treatment-in-wild-type-the-main-effect." class="section level2">
<h2><span class="header-section-number">3.1</span> The effect of treatment in wild-type (the main effect).</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast=</span><span class="kw">c</span>(<span class="st">&quot;condition&quot;</span>,<span class="st">&quot;Trt&quot;</span>,<span class="st">&quot;Ctrl&quot;</span>))
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj) <span class="co"># most significant</span>
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),] <span class="co"># sort</span>
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene275</td>
<td align="right">25.38836</td>
<td align="right">2.607896</td>
<td align="right">0.0000588</td>
<td align="right">0.2684841</td>
</tr>
<tr class="even">
<td align="left">gene2744</td>
<td align="right">101.02954</td>
<td align="right">-1.670837</td>
<td align="right">0.0001099</td>
<td align="right">0.2684841</td>
</tr>
<tr class="odd">
<td align="left">gene5441</td>
<td align="right">58.67469</td>
<td align="right">1.758921</td>
<td align="right">0.0001261</td>
<td align="right">0.2684841</td>
</tr>
<tr class="even">
<td align="left">gene7021</td>
<td align="right">74.29359</td>
<td align="right">1.610853</td>
<td align="right">0.0001345</td>
<td align="right">0.2684841</td>
</tr>
<tr class="odd">
<td align="left">gene7795</td>
<td align="right">326.43308</td>
<td align="right">-1.624323</td>
<td align="right">0.0000407</td>
<td align="right">0.2684841</td>
</tr>
</tbody>
</table>
<p>This is for WT, treated compared with untreated. Note that WT is not mentioned, because it is the reference level. In other words, this is the difference between samples No. 7-9, compared with samples No. 1-3.</p>
<p>Here we show the most significant gene.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-14-1.png" width="576" /></p>
</div>
<div id="the-effect-of-treatment-in-mutant" class="section level2">
<h2><span class="header-section-number">3.2</span> The effect of treatment in mutant</h2>
<p>This is, by definition, the main effect <em>plus</em> the interaction term (the extra condition effect in genotype Mutant compared to genotype WT).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span><span class="kw">results</span>(dds, <span class="kw">list</span>( <span class="kw">c</span>(<span class="st">&quot;condition_Trt_vs_Ctrl&quot;</span>,<span class="st">&quot;genotypeMU.conditionTrt&quot;</span>) ))
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj) <span class="co"># most significant</span>
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),] <span class="co"># sort</span>
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene5102</td>
<td align="right">18.69017</td>
<td align="right">4.757057</td>
<td align="right">1.60e-06</td>
<td align="right">0.0156912</td>
</tr>
<tr class="even">
<td align="left">gene7367</td>
<td align="right">170.69259</td>
<td align="right">1.481016</td>
<td align="right">1.19e-05</td>
<td align="right">0.0396827</td>
</tr>
<tr class="odd">
<td align="left">gene8351</td>
<td align="right">27.77227</td>
<td align="right">3.033622</td>
<td align="right">9.80e-06</td>
<td align="right">0.0396827</td>
</tr>
<tr class="even">
<td align="left">gene8034</td>
<td align="right">53.34342</td>
<td align="right">-1.841023</td>
<td align="right">1.62e-05</td>
<td align="right">0.0403724</td>
</tr>
<tr class="odd">
<td align="left">gene7272</td>
<td align="right">92.82351</td>
<td align="right">-1.414967</td>
<td align="right">6.70e-05</td>
<td align="right">0.1125817</td>
</tr>
</tbody>
</table>
<p>Note that it has to be <em>list</em>( c(&quot;condition_Trt_vs_Ctrl&quot;,&quot;genotypeMU.conditionTrt&quot;) ). If list( ) is ommitted, the results would be drastically different. Perhaps only the first coefficient is used.</p>
<p>This measures the effect of treatment in mutant. In other words, samples No. 10-12 compared with samples No. 4-6.</p>
<p>Here we show the most significant gene, which is downregulated expressed in samples 10-12, than samples 4-6 , as expected.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-16-1.png" width="576" /></p>
</div>
<div id="what-is-the-difference-between-mutant-and-wild-type-without-treatment" class="section level2">
<h2><span class="header-section-number">3.3</span> What is the difference between mutant and wild-type without treatment?</h2>
<p>As Ctrl is the reference level, we can just retrieve the &quot;genotype_MU_vs_WT&quot;.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast=</span><span class="kw">c</span>(<span class="st">&quot;genotype&quot;</span>,<span class="st">&quot;MU&quot;</span>,<span class="st">&quot;WT&quot;</span>))
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj) <span class="co"># most significant</span>
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),] <span class="co"># sort</span>
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene5102</td>
<td align="right">18.69017</td>
<td align="right">-4.714519</td>
<td align="right">0.0000020</td>
<td align="right">0.0195596</td>
</tr>
<tr class="even">
<td align="left">gene2289</td>
<td align="right">45.04711</td>
<td align="right">1.763615</td>
<td align="right">0.0000333</td>
<td align="right">0.1218107</td>
</tr>
<tr class="odd">
<td align="left">gene3388</td>
<td align="right">122.85582</td>
<td align="right">-1.529323</td>
<td align="right">0.0000366</td>
<td align="right">0.1218107</td>
</tr>
<tr class="even">
<td align="left">gene915</td>
<td align="right">39.03250</td>
<td align="right">2.104003</td>
<td align="right">0.0001133</td>
<td align="right">0.2374861</td>
</tr>
<tr class="odd">
<td align="left">gene8351</td>
<td align="right">27.77227</td>
<td align="right">-2.653182</td>
<td align="right">0.0001190</td>
<td align="right">0.2374861</td>
</tr>
</tbody>
</table>
<p>In other words, this is the samples No.4-6 compared with No. 1-3. Here we show the most significant gene.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-18-1.png" width="576" /></p>
</div>
<div id="with-treatment-what-is-the-difference-between-mutant-and-wild-type" class="section level2">
<h2><span class="header-section-number">3.4</span> With treatment, what is the difference between mutant and wild-type?</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">results</span>(dds, <span class="kw">list</span>( <span class="kw">c</span>(<span class="st">&quot;genotype_MU_vs_WT&quot;</span>,<span class="st">&quot;genotypeMU.conditionTrt&quot;</span>) ))
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj) <span class="co"># most significant</span>
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),] <span class="co"># sort</span>
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene4127</td>
<td align="right">50.03677</td>
<td align="right">1.925094</td>
<td align="right">0.0000091</td>
<td align="right">0.0910879</td>
</tr>
<tr class="even">
<td align="left">gene3879</td>
<td align="right">34.67704</td>
<td align="right">-2.133203</td>
<td align="right">0.0000283</td>
<td align="right">0.0940393</td>
</tr>
<tr class="odd">
<td align="left">gene4799</td>
<td align="right">24.11059</td>
<td align="right">-2.459345</td>
<td align="right">0.0000197</td>
<td align="right">0.0940393</td>
</tr>
<tr class="even">
<td align="left">gene5441</td>
<td align="right">58.67469</td>
<td align="right">-1.744769</td>
<td align="right">0.0001418</td>
<td align="right">0.2357639</td>
</tr>
<tr class="odd">
<td align="left">gene5926</td>
<td align="right">161.16737</td>
<td align="right">1.524163</td>
<td align="right">0.0001339</td>
<td align="right">0.2357639</td>
</tr>
</tbody>
</table>
<p>This gives us the difference between genotype MU and WT, under condition Trt. In other words, this is the sampless No. 10-12 compared with samples 7-9.</p>
<p>Here we show the most significant gene.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-20-1.png" width="576" /></p>
</div>
<div id="the-different-response-in-genotypes-interaction-term" class="section level2">
<h2><span class="header-section-number">3.5</span> The different response in genotypes (interaction term)</h2>
<p>Is the effect of treatment <em>different</em> across genotypes? This is the interaction term.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">name=</span><span class="st">&quot;genotypeMU.conditionTrt&quot;</span>)
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj) <span class="co"># most significant</span>
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),] <span class="co"># sort</span>
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene5102</td>
<td align="right">18.69017</td>
<td align="right">7.395771</td>
<td align="right">0.0000000</td>
<td align="right">0.0000341</td>
</tr>
<tr class="even">
<td align="left">gene5441</td>
<td align="right">58.67469</td>
<td align="right">-3.297673</td>
<td align="right">0.0000004</td>
<td align="right">0.0019104</td>
</tr>
<tr class="odd">
<td align="left">gene8034</td>
<td align="right">53.34342</td>
<td align="right">-2.564030</td>
<td align="right">0.0000205</td>
<td align="right">0.0682558</td>
</tr>
<tr class="even">
<td align="left">gene8858</td>
<td align="right">14.68650</td>
<td align="right">4.703936</td>
<td align="right">0.0000297</td>
<td align="right">0.0742076</td>
</tr>
<tr class="odd">
<td align="left">gene4799</td>
<td align="right">24.11059</td>
<td align="right">-2.990101</td>
<td align="right">0.0001234</td>
<td align="right">0.2463661</td>
</tr>
</tbody>
</table>
<p>Here we show the most significant gene.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-22-1.png" width="576" /></p>
<p>In wild-type, this gene is upregulated by treatment, while for the mutant, it is downregulated.</p>
</div>
</div>
<div id="example-4-two-conditionss-three-genotpes-with-interaction-terms" class="section level1">
<h1><span class="header-section-number">4</span> Example 4: Two conditionss, three genotpes with interaction terms</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dds &lt;-<span class="st"> </span><span class="kw">makeExampleDESeqDataSet</span>(<span class="dt">n=</span><span class="dv">10000</span>,<span class="dt">m=</span><span class="dv">18</span>)
dds<span class="op">$</span>genotype &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;I&quot;</span>,<span class="st">&quot;II&quot;</span>,<span class="st">&quot;III&quot;</span>),<span class="dt">each=</span><span class="dv">3</span>),<span class="dv">2</span>))
<span class="kw">colnames</span>(dds) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">rownames</span>(<span class="kw">colData</span>(dds)), <span class="kw">as.character</span>( dds<span class="op">$</span>condition), <span class="kw">as.character</span>( dds<span class="op">$</span>genotype),<span class="dt">sep=</span><span class="st">&quot;_&quot;</span>  )
<span class="kw">colnames</span>(dds) =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;sample&quot;</span>,<span class="st">&quot;S&quot;</span>,<span class="kw">colnames</span>(dds))
<span class="kw">design</span>(dds) &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>genotype <span class="op">+</span><span class="st"> </span>condition <span class="op">+</span><span class="st"> </span>genotype<span class="op">:</span>condition
dds &lt;-<span class="st"> </span><span class="kw">DESeq</span>(dds)
<span class="kw">kable</span>( <span class="kw">colData</span>(dds))</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">condition</th>
<th align="left">genotype</th>
<th align="right">sizeFactor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">S1_A_I</td>
<td align="left">A</td>
<td align="left">I</td>
<td align="right">1.053964</td>
</tr>
<tr class="even">
<td align="left">S2_A_I</td>
<td align="left">A</td>
<td align="left">I</td>
<td align="right">1.058935</td>
</tr>
<tr class="odd">
<td align="left">S3_A_I</td>
<td align="left">A</td>
<td align="left">I</td>
<td align="right">1.061629</td>
</tr>
<tr class="even">
<td align="left">S4_A_II</td>
<td align="left">A</td>
<td align="left">II</td>
<td align="right">1.047347</td>
</tr>
<tr class="odd">
<td align="left">S5_A_II</td>
<td align="left">A</td>
<td align="left">II</td>
<td align="right">1.059813</td>
</tr>
<tr class="even">
<td align="left">S6_A_II</td>
<td align="left">A</td>
<td align="left">II</td>
<td align="right">1.049639</td>
</tr>
<tr class="odd">
<td align="left">S7_A_III</td>
<td align="left">A</td>
<td align="left">III</td>
<td align="right">1.060271</td>
</tr>
<tr class="even">
<td align="left">S8_A_III</td>
<td align="left">A</td>
<td align="left">III</td>
<td align="right">1.057331</td>
</tr>
<tr class="odd">
<td align="left">S9_A_III</td>
<td align="left">A</td>
<td align="left">III</td>
<td align="right">1.052053</td>
</tr>
<tr class="even">
<td align="left">S10_B_I</td>
<td align="left">B</td>
<td align="left">I</td>
<td align="right">1.053989</td>
</tr>
<tr class="odd">
<td align="left">S11_B_I</td>
<td align="left">B</td>
<td align="left">I</td>
<td align="right">1.044408</td>
</tr>
<tr class="even">
<td align="left">S12_B_I</td>
<td align="left">B</td>
<td align="left">I</td>
<td align="right">1.042376</td>
</tr>
<tr class="odd">
<td align="left">S13_B_II</td>
<td align="left">B</td>
<td align="left">II</td>
<td align="right">1.042354</td>
</tr>
<tr class="even">
<td align="left">S14_B_II</td>
<td align="left">B</td>
<td align="left">II</td>
<td align="right">1.050094</td>
</tr>
<tr class="odd">
<td align="left">S15_B_II</td>
<td align="left">B</td>
<td align="left">II</td>
<td align="right">1.045868</td>
</tr>
<tr class="even">
<td align="left">S16_B_III</td>
<td align="left">B</td>
<td align="left">III</td>
<td align="right">1.050772</td>
</tr>
<tr class="odd">
<td align="left">S17_B_III</td>
<td align="left">B</td>
<td align="left">III</td>
<td align="right">1.047934</td>
</tr>
<tr class="even">
<td align="left">S18_B_III</td>
<td align="left">B</td>
<td align="left">III</td>
<td align="right">1.036983</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">resultsNames</span>(dds)</code></pre></div>
<pre><code>## [1] &quot;Intercept&quot;              &quot;genotype_II_vs_I&quot;      
## [3] &quot;genotype_III_vs_I&quot;      &quot;condition_B_vs_A&quot;      
## [5] &quot;genotypeII.conditionB&quot;  &quot;genotypeIII.conditionB&quot;</code></pre>
<div id="the-condition-effect-for-genotype-i-the-main-effect" class="section level2">
<h2><span class="header-section-number">4.1</span> The condition effect for genotype I (the main effect)</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast=</span><span class="kw">c</span>(<span class="st">&quot;condition&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;A&quot;</span>))
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj) <span class="co"># most significant</span>
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),] <span class="co"># sort</span>
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene9348</td>
<td align="right">48.01943</td>
<td align="right">1.915941</td>
<td align="right">0.0000155</td>
<td align="right">0.1546441</td>
</tr>
<tr class="even">
<td align="left">gene928</td>
<td align="right">60.03093</td>
<td align="right">-1.562622</td>
<td align="right">0.0001151</td>
<td align="right">0.5748158</td>
</tr>
<tr class="odd">
<td align="left">gene931</td>
<td align="right">439.23135</td>
<td align="right">-1.101161</td>
<td align="right">0.0004187</td>
<td align="right">0.6066182</td>
</tr>
<tr class="even">
<td align="left">gene4483</td>
<td align="right">16.83153</td>
<td align="right">2.957899</td>
<td align="right">0.0005487</td>
<td align="right">0.6066182</td>
</tr>
<tr class="odd">
<td align="left">gene4612</td>
<td align="right">29.09139</td>
<td align="right">-1.742999</td>
<td align="right">0.0006893</td>
<td align="right">0.6066182</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-24-1.png" width="576" /></p>
</div>
<div id="the-condition-effect-for-genotype-iii." class="section level2">
<h2><span class="header-section-number">4.2</span> The condition effect for genotype III.</h2>
<p>This is the main effect <em>plus</em> the interaction term (the extra condition effect in genotype III compared to genotype I).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast=</span><span class="kw">list</span>( <span class="kw">c</span>(<span class="st">&quot;condition_B_vs_A&quot;</span>,<span class="st">&quot;genotypeIII.conditionB&quot;</span>) ))
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj) <span class="co"># most significant</span>
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),] <span class="co"># sort</span>
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene316</td>
<td align="right">63.666427</td>
<td align="right">-1.724235</td>
<td align="right">0.0000294</td>
<td align="right">0.2936262</td>
</tr>
<tr class="even">
<td align="left">gene252</td>
<td align="right">5.751827</td>
<td align="right">-6.012712</td>
<td align="right">0.0001418</td>
<td align="right">0.2977597</td>
</tr>
<tr class="odd">
<td align="left">gene2068</td>
<td align="right">16.851863</td>
<td align="right">-2.725616</td>
<td align="right">0.0001422</td>
<td align="right">0.2977597</td>
</tr>
<tr class="even">
<td align="left">gene6828</td>
<td align="right">19.669827</td>
<td align="right">2.840392</td>
<td align="right">0.0000635</td>
<td align="right">0.2977597</td>
</tr>
<tr class="odd">
<td align="left">gene7420</td>
<td align="right">85.226424</td>
<td align="right">-1.510240</td>
<td align="right">0.0001788</td>
<td align="right">0.2977597</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-25-1.png" width="576" /></p>
</div>
<div id="the-condition-effect-for-genotype-ii." class="section level2">
<h2><span class="header-section-number">4.3</span> The condition effect for genotype II.</h2>
<p>This is the main effect <em>plus</em> the interaction term (the extra condition effect in genotype II compared to genotype I).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast=</span><span class="kw">list</span>( <span class="kw">c</span>(<span class="st">&quot;condition_B_vs_A&quot;</span>,<span class="st">&quot;genotypeII.conditionB&quot;</span>) ))
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj) <span class="co"># most significant</span>
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),] <span class="co"># sort</span>
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene980</td>
<td align="right">71.929692</td>
<td align="right">-1.711667</td>
<td align="right">0.0005822</td>
<td align="right">0.648323</td>
</tr>
<tr class="even">
<td align="left">gene1177</td>
<td align="right">109.057633</td>
<td align="right">-1.281177</td>
<td align="right">0.0002111</td>
<td align="right">0.648323</td>
</tr>
<tr class="odd">
<td align="left">gene5118</td>
<td align="right">3.487054</td>
<td align="right">-5.757413</td>
<td align="right">0.0005110</td>
<td align="right">0.648323</td>
</tr>
<tr class="even">
<td align="left">gene5570</td>
<td align="right">23.786589</td>
<td align="right">2.329791</td>
<td align="right">0.0004286</td>
<td align="right">0.648323</td>
</tr>
<tr class="odd">
<td align="left">gene6519</td>
<td align="right">94.137270</td>
<td align="right">1.422193</td>
<td align="right">0.0001399</td>
<td align="right">0.648323</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-26-1.png" width="576" /></p>
<p>This is equivalent to using numeric vector referencing to each of the results.</p>
<p>[1] &quot;Intercept&quot; &quot;genotype_II_vs_I&quot; &quot;genotype_III_vs_I&quot;<br />
[4] &quot;condition_B_vs_A&quot; &quot;genotypeII.conditionB&quot; &quot;genotypeIII.conditionB&quot;</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast=</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>))
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj) <span class="co"># most significant</span>
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),] <span class="co"># sort</span>
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene980</td>
<td align="right">71.929692</td>
<td align="right">-1.711667</td>
<td align="right">0.0005822</td>
<td align="right">0.648323</td>
</tr>
<tr class="even">
<td align="left">gene1177</td>
<td align="right">109.057633</td>
<td align="right">-1.281177</td>
<td align="right">0.0002111</td>
<td align="right">0.648323</td>
</tr>
<tr class="odd">
<td align="left">gene5118</td>
<td align="right">3.487054</td>
<td align="right">-5.757413</td>
<td align="right">0.0005110</td>
<td align="right">0.648323</td>
</tr>
<tr class="even">
<td align="left">gene5570</td>
<td align="right">23.786589</td>
<td align="right">2.329791</td>
<td align="right">0.0004286</td>
<td align="right">0.648323</td>
</tr>
<tr class="odd">
<td align="left">gene6519</td>
<td align="right">94.137270</td>
<td align="right">1.422193</td>
<td align="right">0.0001399</td>
<td align="right">0.648323</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-27-1.png" width="576" /></p>
</div>
<div id="the-effect-of-iii-vs.-ii-under-condition-a." class="section level2">
<h2><span class="header-section-number">4.4</span> The effect of III vs. II, under condition A.</h2>
<p>This is the effect of &quot;genotype_III_vs_I&quot; <em>minus</em> &quot;genotype_II_vs_I&quot; ?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast=</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj) <span class="co"># most significant</span>
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),] <span class="co"># sort</span>
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene7875</td>
<td align="right">172.84101</td>
<td align="right">1.316870</td>
<td align="right">0.0000354</td>
<td align="right">0.3541800</td>
</tr>
<tr class="even">
<td align="left">gene316</td>
<td align="right">63.66643</td>
<td align="right">1.399247</td>
<td align="right">0.0006044</td>
<td align="right">0.5256726</td>
</tr>
<tr class="odd">
<td align="left">gene557</td>
<td align="right">17.92683</td>
<td align="right">-1.980097</td>
<td align="right">0.0008418</td>
<td align="right">0.5256726</td>
</tr>
<tr class="even">
<td align="left">gene1243</td>
<td align="right">51.92628</td>
<td align="right">-1.844387</td>
<td align="right">0.0004523</td>
<td align="right">0.5256726</td>
</tr>
<tr class="odd">
<td align="left">gene1702</td>
<td align="right">55.34857</td>
<td align="right">-1.631481</td>
<td align="right">0.0006698</td>
<td align="right">0.5256726</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-28-1.png" width="576" /></p>
</div>
<div id="the-interaction-term-for-condition-effect-in-genotype-iii-vs-genotype-i." class="section level2">
<h2><span class="header-section-number">4.5</span> The interaction term for condition effect in genotype III vs genotype I.</h2>
<p>This tests if the condition effect is different in III compared to I</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">name=</span><span class="st">&quot;genotypeIII.conditionB&quot;</span>)
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj) <span class="co"># most significant</span>
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),] <span class="co"># sort</span>
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene9348</td>
<td align="right">48.019429</td>
<td align="right">-2.714891</td>
<td align="right">0.0000104</td>
<td align="right">0.1042074</td>
</tr>
<tr class="even">
<td align="left">gene6251</td>
<td align="right">14.477069</td>
<td align="right">-4.780646</td>
<td align="right">0.0000479</td>
<td align="right">0.2395245</td>
</tr>
<tr class="odd">
<td align="left">gene839</td>
<td align="right">161.393935</td>
<td align="right">-1.662756</td>
<td align="right">0.0000886</td>
<td align="right">0.2950638</td>
</tr>
<tr class="even">
<td align="left">gene9383</td>
<td align="right">9.149222</td>
<td align="right">-6.436304</td>
<td align="right">0.0001560</td>
<td align="right">0.3896367</td>
</tr>
<tr class="odd">
<td align="left">gene931</td>
<td align="right">439.231351</td>
<td align="right">1.562204</td>
<td align="right">0.0003858</td>
<td align="right">0.4506833</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-29-1.png" width="576" /></p>
</div>
<div id="the-interaction-term-for-condition-effect-in-genotype-iii-vs-genotype-ii." class="section level2">
<h2><span class="header-section-number">4.6</span> The interaction term for condition effect in genotype III vs genotype II.</h2>
<p>This tests if the condition effect is different in III compared to II</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast=</span><span class="kw">list</span>(<span class="st">&quot;genotypeIII.conditionB&quot;</span>, <span class="st">&quot;genotypeII.conditionB&quot;</span>))
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj) <span class="co"># most significant</span>
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),] <span class="co"># sort</span>
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene5761</td>
<td align="right">27.797507</td>
<td align="right">4.231182</td>
<td align="right">0.0000012</td>
<td align="right">0.0116510</td>
</tr>
<tr class="even">
<td align="left">gene6598</td>
<td align="right">100.143591</td>
<td align="right">2.317486</td>
<td align="right">0.0000214</td>
<td align="right">0.1068006</td>
</tr>
<tr class="odd">
<td align="left">gene3491</td>
<td align="right">325.224707</td>
<td align="right">1.942243</td>
<td align="right">0.0001168</td>
<td align="right">0.2853814</td>
</tr>
<tr class="even">
<td align="left">gene4635</td>
<td align="right">8.411707</td>
<td align="right">5.206116</td>
<td align="right">0.0000963</td>
<td align="right">0.2853814</td>
</tr>
<tr class="odd">
<td align="left">gene5118</td>
<td align="right">3.487054</td>
<td align="right">8.088922</td>
<td align="right">0.0002454</td>
<td align="right">0.2853814</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-30-1.png" width="576" /></p>
</div>
</div>
<div id="example-5-three-conditions-three-genotypes-with-interaction-terms" class="section level1">
<h1><span class="header-section-number">5</span> Example 5: Three conditions, three genotypes with interaction terms</h1>
<p>For a more complex example, we now have a 3x3 factorial design. It is convenent to use a diagram to represent study design and the coefficients generated by DESeq2. Each connections in the diagram below represents a coefficient for a contrast and we can use the combination of these to define desired contrasts by travelling through the graph/network. <img src="I:/factors5.jpg" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dds &lt;-<span class="st"> </span><span class="kw">makeExampleDESeqDataSet</span>(<span class="dt">n=</span><span class="dv">10000</span>,<span class="dt">m=</span><span class="dv">18</span>)
dds<span class="op">$</span>genotype &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;I&quot;</span>,<span class="st">&quot;II&quot;</span>,<span class="st">&quot;III&quot;</span>),<span class="dt">each=</span><span class="dv">3</span>),<span class="dv">2</span>))
dds<span class="op">$</span>condition &lt;-<span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>), <span class="dv">6</span>)  )
<span class="kw">colnames</span>(dds) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">as.character</span>( dds<span class="op">$</span>genotype), <span class="kw">as.character</span>( dds<span class="op">$</span>condition),<span class="kw">rownames</span>(<span class="kw">colData</span>(dds)), <span class="dt">sep=</span><span class="st">&quot;_&quot;</span>  )
<span class="kw">colnames</span>(dds) =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;sample&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="kw">colnames</span>(dds))
<span class="kw">design</span>(dds) &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>genotype <span class="op">+</span><span class="st"> </span>condition <span class="op">+</span><span class="st"> </span>genotype<span class="op">:</span>condition
dds &lt;-<span class="st"> </span><span class="kw">DESeq</span>(dds)
<span class="kw">kable</span>( <span class="kw">colData</span>(dds))</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">condition</th>
<th align="left">genotype</th>
<th align="right">sizeFactor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">I_A_1</td>
<td align="left">A</td>
<td align="left">I</td>
<td align="right">1.055853</td>
</tr>
<tr class="even">
<td align="left">I_B_2</td>
<td align="left">B</td>
<td align="left">I</td>
<td align="right">1.037228</td>
</tr>
<tr class="odd">
<td align="left">I_C_3</td>
<td align="left">C</td>
<td align="left">I</td>
<td align="right">1.048146</td>
</tr>
<tr class="even">
<td align="left">II_A_4</td>
<td align="left">A</td>
<td align="left">II</td>
<td align="right">1.048901</td>
</tr>
<tr class="odd">
<td align="left">II_B_5</td>
<td align="left">B</td>
<td align="left">II</td>
<td align="right">1.062858</td>
</tr>
<tr class="even">
<td align="left">II_C_6</td>
<td align="left">C</td>
<td align="left">II</td>
<td align="right">1.036711</td>
</tr>
<tr class="odd">
<td align="left">III_A_7</td>
<td align="left">A</td>
<td align="left">III</td>
<td align="right">1.052625</td>
</tr>
<tr class="even">
<td align="left">III_B_8</td>
<td align="left">B</td>
<td align="left">III</td>
<td align="right">1.033361</td>
</tr>
<tr class="odd">
<td align="left">III_C_9</td>
<td align="left">C</td>
<td align="left">III</td>
<td align="right">1.040028</td>
</tr>
<tr class="even">
<td align="left">I_A_10</td>
<td align="left">A</td>
<td align="left">I</td>
<td align="right">1.054525</td>
</tr>
<tr class="odd">
<td align="left">I_B_11</td>
<td align="left">B</td>
<td align="left">I</td>
<td align="right">1.045331</td>
</tr>
<tr class="even">
<td align="left">I_C_12</td>
<td align="left">C</td>
<td align="left">I</td>
<td align="right">1.036150</td>
</tr>
<tr class="odd">
<td align="left">II_A_13</td>
<td align="left">A</td>
<td align="left">II</td>
<td align="right">1.052502</td>
</tr>
<tr class="even">
<td align="left">II_B_14</td>
<td align="left">B</td>
<td align="left">II</td>
<td align="right">1.047103</td>
</tr>
<tr class="odd">
<td align="left">II_C_15</td>
<td align="left">C</td>
<td align="left">II</td>
<td align="right">1.063802</td>
</tr>
<tr class="even">
<td align="left">III_A_16</td>
<td align="left">A</td>
<td align="left">III</td>
<td align="right">1.053762</td>
</tr>
<tr class="odd">
<td align="left">III_B_17</td>
<td align="left">B</td>
<td align="left">III</td>
<td align="right">1.041255</td>
</tr>
<tr class="even">
<td align="left">III_C_18</td>
<td align="left">C</td>
<td align="left">III</td>
<td align="right">1.048660</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">resultsNames</span>(dds)</code></pre></div>
<pre><code>## [1] &quot;Intercept&quot;              &quot;genotype_II_vs_I&quot;      
## [3] &quot;genotype_III_vs_I&quot;      &quot;condition_B_vs_A&quot;      
## [5] &quot;condition_C_vs_A&quot;       &quot;genotypeII.conditionB&quot; 
## [7] &quot;genotypeIII.conditionB&quot; &quot;genotypeII.conditionC&quot; 
## [9] &quot;genotypeIII.conditionC&quot;</code></pre>
<p>To derive desired contrasts, we can travel on the network of factor levels, using the given 9 coefficients as bridges.For example, we are interested in the difference between genotpes III vs. II, under condition C. This is not readily available. But we can travel from C to III, then III to I, I to II, and then II to C. Namely the path is C--III--I--II--C. In terms of coefficients: (III-I) - (II-I) + III.C - II.C= &quot;genotype_III_vs_I&quot; - &quot;genotype_II_vs_I&quot; + &quot;genotypeIII.conditionC&quot; - &quot;genotypeII.conditionC&quot; For such a complex contrast, we can use the numerical combination using a vector: c(0,-1,1,0,0,0,0,-1,1 ) These numbers are applied to the coefficients in the resultsNames. To double check we order them:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cbind</span>(<span class="kw">resultsNames</span>(dds),<span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span> ) )</code></pre></div>
<pre><code>##       [,1]                     [,2]
##  [1,] &quot;Intercept&quot;              &quot;0&quot; 
##  [2,] &quot;genotype_II_vs_I&quot;       &quot;-1&quot;
##  [3,] &quot;genotype_III_vs_I&quot;      &quot;1&quot; 
##  [4,] &quot;condition_B_vs_A&quot;       &quot;0&quot; 
##  [5,] &quot;condition_C_vs_A&quot;       &quot;0&quot; 
##  [6,] &quot;genotypeII.conditionB&quot;  &quot;0&quot; 
##  [7,] &quot;genotypeIII.conditionB&quot; &quot;0&quot; 
##  [8,] &quot;genotypeII.conditionC&quot;  &quot;-1&quot;
##  [9,] &quot;genotypeIII.conditionC&quot; &quot;1&quot;</code></pre>
<p>Now we can extract the contrast. ## The effect of III vs. II, under condition C.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast=</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span> ))
ix =<span class="st"> </span><span class="kw">which.min</span>(res<span class="op">$</span>padj) <span class="co"># most significant</span>
res &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>padj),] <span class="co"># sort</span>
<span class="kw">kable</span>(res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">baseMean</th>
<th align="right">log2FoldChange</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene793</td>
<td align="right">50.368566</td>
<td align="right">3.737810</td>
<td align="right">3.36e-05</td>
<td align="right">0.1460573</td>
</tr>
<tr class="even">
<td align="left">gene1161</td>
<td align="right">827.243573</td>
<td align="right">1.844200</td>
<td align="right">4.39e-05</td>
<td align="right">0.1460573</td>
</tr>
<tr class="odd">
<td align="left">gene3314</td>
<td align="right">23.430794</td>
<td align="right">4.580687</td>
<td align="right">1.57e-05</td>
<td align="right">0.1460573</td>
</tr>
<tr class="even">
<td align="left">gene4445</td>
<td align="right">51.054925</td>
<td align="right">-3.096770</td>
<td align="right">6.96e-05</td>
<td align="right">0.1736784</td>
</tr>
<tr class="odd">
<td align="left">gene1555</td>
<td align="right">5.073803</td>
<td align="right">10.771498</td>
<td align="right">9.70e-05</td>
<td align="right">0.1937244</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">assay</span>(dds)[ix,],<span class="dt">las=</span><span class="dv">2</span>, <span class="dt">main=</span><span class="kw">rownames</span>(dds)[ ix  ]  )</code></pre></div>
<p><img src="2018-07-02-deseq2-experimental-design-and-interpretation_files/figure-html/unnamed-chunk-33-1.png" width="576" /></p>
<p>How about many factors, each with many levels? It's going to become increasingly complex. Drawing a network graph like the one above can help you find the right combination.</p>
<p>Please let me know if you have any comment.</p>
</div>
